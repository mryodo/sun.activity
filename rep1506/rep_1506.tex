%% LyX 2.2.3 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
\documentclass[russian]{article}
\usepackage[T2A,T1,T2A]{fontenc}
\usepackage[koi8-r]{inputenc}
\usepackage{float}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
\DeclareRobustCommand{\cyrtext}{%
  \fontencoding{T2A}\selectfont\def\encodingdefault{T2A}}
\DeclareRobustCommand{\textcyr}[1]{\leavevmode{\cyrtext #1}}


\@ifundefined{showcaptionsetup}{}{%
 \PassOptionsToPackage{caption=false}{subfig}}
\usepackage{subfig}
\makeatother

\usepackage{babel}
\begin{document}

\section{Восстановление параметров модели Курамото}

Для начала зададим некоторый набор переменных: частоту $\Omega=2\pi$
и их разницу $\Delta\omega=0.1$.

Тогда период $T=\frac{2\pi}{\Omega}=1$. Общее время исследования
положим $L=nT$, где переменная $n\in\mathbb{N}$ есть количество
периодов в изучаемом отрезке времени. Положим $n=5$ для проверки
работы процесса восстановления.

Наиболее болезненным является вопрос сетки: положим на ней отрезок
$[0;L]$ с $N_{grid}$ точек, полученный шаг сетки обозначим $h$,
$h=\frac{L}{N_{grid}+1}$.

Зададим функцию $k_{0}(t)$ \textemdash{} первое приближение параметров
системы. 

\[
k_{0}(t)=\begin{cases}
d,\quad0\le t\le2T\;\wedge\;t\ge2T+\tau\\
d+\Delta d,\quad0\le t\le2T+\tau
\end{cases}
\]

Здесь $d$ положим невозмущенным значением; $\Delta d$ - амплитудой
шока; $\tau$ - длительностью шока.

Для программного задания ведем дополнительный параметр: количество
точек на период $p=\frac{T}{h}$; аналогично $s$ - для длины шока,
$s\cdot h=\tau$.

\begin{figure}[H]
\begin{centering}
\includegraphics[width=0.8\columnwidth]{k0_try}
\par\end{centering}
\centering{}\caption{График исследуемой функции $k_{0}(t)$ на за время $L=5T$ c шоком
$\Delta d=d$ длительностью $\tau=T/2$.}
\end{figure}

Решим уравнение
\begin{align}
\dot{\theta} & =2\Delta w-\kappa_{0}(t)\sin\theta\label{eq:dif}\\
\theta(0) & =init\nonumber 
\end{align}

где начальное значение $init$ выберем образом, который будет описан
чуть ниже. Для решения данного уравнения применим метод Рунге-Кутты
4-5 порядка\footnote{имеющиеся в программных средах Matlab и Python реализации данного
метода выдавали сомнительные результаты, поэтому метод было решено
реализовать самостоятельно следующим образом (для уравнения $\dot{x}=f(x,t)$):

\[
\begin{align}x_{0}= & init\\
x_{i+1}= & x_{i}+\frac{k_{1}+2k_{2}+2k_{3}+k_{4}}{6}
\end{align}
\]

где

\[
\begin{align}k_{1}= & f(t_{i},x_{i})h\\
k_{2}= & f(t_{i}+h/2,x_{i}+k_{1}/2)h\\
k_{3}= & f(t_{i}+h/2,x_{i}+k_{2}/2)h\\
k_{4}= & f(t_{i}+h,x_{i}+k_{3})h
\end{align}
\]

В случае нашего уравнения $f=2\Delta w-k_{0}(t)\sin\theta$. Как можно
видеть, метод оперирует с полуцелыми точками сетки; в рамках текущей
работы проблемы была решена интерполяцией массива $k_{0}(t)$ на полуцелые
точки сетки; в ситуации параметров, где качество интерполяции создает
существенную погрешность (например, если они зашумлены), начальная
сетка по времени, т.е. величина $N_{grid}$ должна быть выбрана вдвое
меньше, чем реальная сетка на параметры, чтобы обойти недостатки,
создаваемые интерполяцией.} . Решение уравнения обозначим как $\theta(t)$.

\begin{figure}[H]
\centering{}\includegraphics[width=0.8\columnwidth]{theta_try}\caption{Решение уравнения (\ref{eq:dif}) при $T=1$, $n=5$, $\Delta w=0.1$,
$k_{0}(t)$ выбранному с $d=\Delta d=0.25$, $\tau=T/2$; начальное
условие $init$ выбрано согласованным с стационарным случаем.}
\end{figure}

Для восстановления введем два ``виртуальных маятника'' с фазовой
разницей $\theta(t)$, т.е.

\[
\begin{cases}
x_{o}(t)=\sin(\Omega t)\\
y_{0}(t)=\sin(\Omega t+\theta(t))
\end{cases}
\]

\begin{figure}[H]
\centering{}\includegraphics[width=0.8\columnwidth]{x0y0_try}\caption{Виртуальные маятники для найденной фазовой разницы $\theta(t)$}
\end{figure}

Для них посчитаем скользящую корреляцию $C_{0}(t)$ по следующей формуле:

\[
C_{0}(t)=\frac{\int_{t-T/2}^{t+T/2}\sin(\Omega\tau)\sin(\Omega\tau+\theta_{0}(\tau))d\tau}{\sqrt{\int_{t-T/2}^{t+T/2}\sin^{2}(\Omega\tau)d\tau\cdot\int_{t-T/2}^{t+T/2}\sin^{2}(\Omega\tau+\theta_{0}(\tau))d\tau}}
\]

\textbf{\emph{Важно}}: приведенный метод вычисления $C_{0}(t)$ исходит
обращается к значениям функции $\theta(t)$ при $t<0$ и $t>L$ (согласно
пределам интегрирования), если пытаться посчитать корреляцию $C_{0}(t)$
на всем отрезке времени $[0;L]$. Формально говоря, можно достроить
необходимые участки решения $\theta(t)$, правильно выбирая начальные
значения; в то же время, мы заведомо выбираем достаточное $n$ \textemdash{}
число периодов \textemdash{} чтобы все существенные особенности (т.е.
реакция на шок) были видны, поэтому в текущей работе $C_{0}(t)$ вычисленна
на доступной ей интервале $\left[\frac{T}{2};L-\frac{T}{2}\right]$
без дополнительных построений решений дифференциального уравнения
(при желании, их можно добавить).

Теперь воспользуемся предположением о квазистационарности решения:
если фазовая разница между маятниками (обозначим ее $\varphi_{0}$)
постоянна по времени, то $C_{0}(t)=\cos\varphi_{0}$. Отсюда получаем,
что:

\[
\varphi_{0}(t)=\arccos C_{0}(t)
\]

С другой стороны, по построению маятников известно, что фазовая разница
(непостоянная) есть $\theta(t)$. Соответственно, если восстановление
было удачным, получившиеся функции должны быть относительно похожими
(здесь мы намеренно не обсуждаем вопрос о метриках, который будет
освещен ниже при разговоре о качестве восстановленных параметров).

\begin{figure}[H]
\centering{}\includegraphics[width=0.8\columnwidth]{phi_try}\caption{Сравнение функций $\theta(t)$ \textemdash{} решения изначального
уравнения с нулевым приближением параметров и $\varphi_{0}(t)$ \textemdash{}
полученной по нему при помощи виртуальных маятников фазовой разницы.}
\end{figure}

\textbf{\emph{Важно}}: теперь обратимся к вопросу о начальном условии
для дифференциального уравнения (\ref{eq:dif}). Потребуем, чтобы
хотя бы в начальный момент времени процедура восстановления была бы
корректной, т.е. в момент времени $t=0$ решение стационарно, т.е.
$\dot{\theta}=0$, т.е.
\[
0=2\Delta w-k_{0}(0)\sin\theta(0),
\]

откуда 
\[
init=\theta(0)=\arcsin\frac{2\Delta w}{k_{0}(0)}
\]

Вообще говоря, подобное выражение выглядит сомнительным: из него немедленно
следует условие 
\[
\left|\frac{2\Delta w}{k_{0}(0)}\right|\le1,
\]

что накладывает существенные ограничения на пространство возможных
параметров маятников; с другой стороны, возникает надежда, что существует
некоторое физическое объяснение, почему подобное неравенство всегда
выполняется.

Выразим параметр-функцию:

\[
\dot{\theta}=2\Delta w-k(t)\sin\theta
\]

\[
k(t)=\frac{2\Delta w-\dot{\theta}}{\sin\theta}
\]

Подставляя найденное $\theta\approx\varphi_{0}$, для котрого $\dot{\varphi}_{0}=0$,
получаем новую параметр-функцию:

\[
\hat{k}(t)=\frac{2\Delta w}{\sin\varphi_{0}(t)}
\]

\begin{figure}[H]
\centering{}\includegraphics[width=0.8\columnwidth]{khat_try}\caption{Итог реконструкции: графики параметров $k_{0}(t)$ и восстановленное
$\hat{k}(t)$. Заметим, что стаблизация к безшоковому состоянию не
произошла, поэтому для дальнейших исследований число периодов $n$
было увеличено.}
\end{figure}

\paragraph{Качество восстановления.}

Вопрос о том, насколько качественно проведена была реконструкция,
напрямую зависит от метрики, относительно которой мы рассматриваем
близость функций. По большому счету, это построение важнее для следующей
части данного отчета, поэтому здесь мы просто сформулируем тот набор
статистик, который мы собираем с полученных функций.
\begin{enumerate}
\item $jumpK$ \textemdash{} отклонение восстановленной функции $\hat{k}(t)$
на выходе из шока относительно ампилтуды шока, т.е.
\[
jumpK=\frac{\hat{k}(2T+\tau)-d}{\Delta d}
\]
\item $jumpKC$ \textemdash{} аналог С\textendash метрики на отрезке времени
после шока; формально это поправка на то, что наибольшее отклонение
от $k_{0}(t)$ функция $\hat{k}(t)$ может реализовывать не на выходе
из шока, а несколько позже:
\[
jumpKC=\frac{1}{\Delta d}\left(\max\limits _{t\ge2T+\tau}\hat{k}(t)-d\right)
\]
\item $jumpKR$ \textemdash{} обычная $\mathbb{L}_{2}$\textendash метрика
на функции, за исключением того, что мы нормируем ее на длину изучаемого
времени:
\[
jumpKR=\frac{1}{L}\sqrt{\int\limits _{0}^{L}\left(\hat{k}(\tau)-k_{0}(\tau\right)^{2}d\tau}
\]
\item $jumpKR0$ \textemdash{} модифицированная предыдущая метрика, которая
учитывает дисперсность $k_{0}(t)$ (полагаю, что сильно зашумленные
функции она бы спасла):
\[
jumpKR0=\frac{\frac{1}{L}\sqrt{\int\limits _{0}^{L}\left(\hat{k}(\tau)-k_{0}(\tau\right)^{2}d\tau}}{\sigma(k_{0}(t))}
\]
\end{enumerate}

\section{Зависимость качества восстановления ($jumpK$, $jumpKC$, $jumpKR$,
$jumpKR0$) от длительности шока ($\tau/T$)}

По большому счету, вся техническая работа по введению параметров и
описанию модели, в рамках которой мы проводим такое исследование,
была проведена выше, но давайте аккуратно соберем все численные параметры.

Итак, в рамках нашей модели мы исследуем качество восстановления в
четырех приведенных выше метриках относительно длительности шока нулевого
приближения параметров $k_{0}(t)$, нормированной на период маятников,
т.е. $\tau/T$.

Для вычислений было выбрано: $\Omega=2\pi$, $\Delta w=0.1$, $T=1$,
$n=10$ (исходя из эксперимента выше, чтобы была некоторая стабилизация
к дошоковому состоянию), $L=nT$; невозмущенное значение параметра
$k_{0}(t)$ было выбрано $d=0.25$, амплитуда шока $\Delta d=0.25$,
начало шока \textemdash{} момент времени $2T$ (из-за необходимости
\flqq{}отступить\frqq{} от $0$ хотя бы на $T/2$, чтобы получить
$C_{0}(t)$, кажется разумным оставить \flqq{}задел\frqq{} для системы,
чтобы она пробыла в невозмущенном состоянии какое-то время).

Приведем результаты на графиках:
\begin{enumerate}
\item Графики \ref{fig:k} и \ref{fig:kc} при первом взгляде не содержат
существенных отличий, что подтверждает гипотезу о том, что максимальная
амплитуда отклонения достигается на выходе из шока; однако совместные
графики \ref{fig:kkc2} и \ref{fig:kkc10} ниже показывают, что подобное
совпадение наблюдается только при длительных возмущениях (рис. \ref{fig:kkc10});
при коротких возмущениях система достигает наибольшего отклонения
уже после шока (рис. \ref{fig:kkc2}). \emph{Возможно, интересным
было насколько позже?} \\
\begin{figure}[H]
\begin{centering}
\subfloat[Сравнение в метрике\label{fig:k} $jumpK$]{\centering{}\includegraphics[width=0.5\columnwidth]{jumpK}}\subfloat[Сравнение в мет\label{fig:kc}рике $jumpKC$]{\centering{}\includegraphics[width=0.5\columnwidth]{jumpKC}}
\par\end{centering}
\centering{}\caption{Амплитуда отклонения после шока}
\end{figure}

\begin{figure}[H]
\begin{centering}
\subfloat[При длительности шока, меньшей $2T$\label{fig:kkc2}]{\centering{}\includegraphics[width=0.5\columnwidth]{kkc2}}\subfloat[\label{fig:kkc10}На все отрезке времени]{\centering{}\includegraphics[width=0.5\columnwidth]{kkc10}}
\par\end{centering}
\centering{}\caption{Сравнение результатов $jumpK$ и $jumpKC$}
\end{figure}
\item Обращает на себя внимание появление, затухание и более акцентированное
появление колебаний на графиках \ref{fig:k} и \ref{fig:kc}: если
первый (по времени) период колебаний может являться следствием того,
что система, испытавшая кратковременный по сравнению со своим периодом
шок, условно \flqq{}еще не привыкла\frqq{} к возмущению, вследствие
чего возникает данная картинка; то второй (по времени) период колебаний
вероятно связан с отсутствием значительной стабилизации параметров
после шока (поскольку в невозмущенном состоянии после шока $k_{0}(t)$
находится сравнительно малый отрезок времени). \emph{Впрочем, ясно,
что это довольно сомнительные объяснения\ldots{}}
\item Также необходимо заметить, что графики \ref{fig:kr} и \ref{fig:kr0}
дают принципиально разный ответ на вопрос о качестве восстановленной
параметр-функции: график \ref{fig:kr} дает значение ошибки не больше
$0.042$, а график \ref{fig:kr0} \textemdash{} никак не меньше $0.315$.
\emph{Кажется, $0.315$ \textemdash{} это же чудовищно много\ldots{}}\\
\begin{figure}[H]
\begin{centering}
\subfloat[Сравнение в мет\label{fig:kr}рике $jumpKR$]{\centering{}\includegraphics[width=0.5\columnwidth]{jumpKR}}\subfloat[Сравн\label{fig:kr0}ение в метрике $jumpKR0$]{\centering{}\includegraphics[width=0.5\columnwidth]{jumpKR0}}
\par\end{centering}
\centering{}\caption{Качество восстановления}
\end{figure}
\item Отметим еще одну особенность: оба графика \ref{fig:kr} и \ref{fig:kr0}
показывают, что у ошибки есть максимум (\emph{отдельная прекрасная
особенность, что они у них не совпадают, а жаль};\emph{ видимо, метрики
все-таки очень разные}); то есть в некотором смысле можно говорить
о том, что существует некий порог длительности шока (соответствующий
максимуму на одном из графиков), после которого система \flqq{}привыкает\frqq{}
к возмущенному состоянию и пытается стабилизироваться уже вокруг него.
\emph{Вероятно, здесь имеет смысл увеличить общее время исследования,
чтобы исключить вероятность того, что это вызвано просто концом области
интегрирования дифференциального уравнения}.
\end{enumerate}

\end{document}
